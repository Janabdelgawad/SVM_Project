<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Risk Prediction Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #3498db;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .results {
            background-color: #f1f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 5px solid #3498db;
            display: none;
        }
        .high-risk {
            border-color: #e74c3c;
            background-color: #fff5f5;
        }
        .low-risk {
            border-color: #2ecc71;
            background-color: #f5fff7;
        }
        .probability-meter {
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f39c12, #e74c3c);
            width: 0%;
            transition: width 1s ease-in-out;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f8f9fa;
        }
        .tab.active {
            background-color: white;
            border-color: #ddd;
            color: #3498db;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .file-upload {
            border: 2px dashed #ddd;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-upload:hover {
            border-color: #3498db;
            background-color: #f1f9ff;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            color: #777;
            font-size: 14px;
        }
        .feature-info {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }
        .tooltip-icon {
            color: #3498db;
            font-weight: bold;
            font-size: 14px;
            border: 1px solid #3498db;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        @media (max-width: 768px) {
            .form-col {
                flex: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Diabetes Risk Prediction Tool</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="manual-entry">Manual Data Entry</div>
            <div class="tab" data-tab="file-upload">File Upload</div>
        </div>
        
        <div id="manual-entry" class="tab-content active">
            <p>Enter your health information below to get a prediction on your diabetes risk.</p>
            
            <form id="prediction-form">
                <h2>General Health Information</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="age">Age Group:</label>
                            <select id="age" name="age">
                                <option value="1">18 to 24</option>
                                <option value="2">25 to 29</option>
                                <option value="3">30 to 34</option>
                                <option value="4">35 to 39</option>
                                <option value="5">40 to 44</option>
                                <option value="6">45 to 49</option>
                                <option value="7">50 to 54</option>
                                <option value="8">55 to 59</option>
                                <option value="9">60 to 64</option>
                                <option value="10">65 to 69</option>
                                <option value="11">70 to 74</option>
                                <option value="12">75 to 79</option>
                                <option value="13">80 or older</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="sex">Sex:</label>
                            <select id="sex" name="sex">
                                <option value="0">Female</option>
                                <option value="1">Male</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="bmi">
                                BMI:
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Body Mass Index. Weight (kg) / [Height (m)]Â²</span>
                                </div>
                            </label>
                            <input type="number" id="bmi" name="bmi" min="10" max="100" step="0.1" required>
                            <div class="feature-info">Normal range: 18.5-24.9</div>
                        </div>
                    </div>
                </div>

                <h2>Medical Conditions</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="highBP">High Blood Pressure:</label>
                            <select id="highBP" name="highBP">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="highChol">High Cholesterol:</label>
                            <select id="highChol" name="highChol">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="cholCheck">Cholesterol Check (last 5 years):</label>
                            <select id="cholCheck" name="cholCheck">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="stroke">History of Stroke:</label>
                            <select id="stroke" name="stroke">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="heartDisease">Heart Disease or Heart Attack:</label>
                            <select id="heartDisease" name="heartDisease">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="diffWalk">Difficulty Walking:</label>
                            <select id="diffWalk" name="diffWalk">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <h2>Lifestyle Factors</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="smoker">Smoker (lifetime â¥100 cigarettes):</label>
                            <select id="smoker" name="smoker">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="physActivity">Physical Activity (past 30 days):</label>
                            <select id="physActivity" name="physActivity">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="hvyAlcoholConsump">Heavy Alcohol Consumption:</label>
                            <select id="hvyAlcoholConsump" name="hvyAlcoholConsump">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                            <div class="feature-info">Men >14 drinks/week, women >7</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="fruits">Daily Fruit Consumption:</label>
                            <select id="fruits" name="fruits">
                                <option value="0">Less than once per day</option>
                                <option value="1">Once or more per day</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="veggies">Daily Vegetable Consumption:</label>
                            <select id="veggies" name="veggies">
                                <option value="0">Less than once per day</option>
                                <option value="1">Once or more per day</option>
                            </select>
                        </div>
                    </div>
                </div>

                <h2>Healthcare Access</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="anyHealthcare">Have Healthcare Coverage:</label>
                            <select id="anyHealthcare" name="anyHealthcare">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="noDocbcCost">Avoided Doctor Due to Cost:</label>
                            <select id="noDocbcCost" name="noDocbcCost">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <h2>Self-Reported Health Status</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="genHlth">General Health:</label>
                            <select id="genHlth" name="genHlth">
                                <option value="1">Excellent</option>
                                <option value="2">Very good</option>
                                <option value="3">Good</option>
                                <option value="4">Fair</option>
                                <option value="5">Poor</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="mentHlth">Poor Mental Health Days (past 30 days):</label>
                            <input type="number" id="mentHlth" name="mentHlth" min="0" max="30" step="1" value="0">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="physHlth">Poor Physical Health Days (past 30 days):</label>
                            <input type="number" id="physHlth" name="physHlth" min="0" max="30" step="1" value="0">
                        </div>
                    </div>
                </div>

                <h2>Socioeconomic Status</h2>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="education">Education Level:</label>
                            <select id="education" name="education">
                                <option value="1">Never attended school/only kindergarten</option>
                                <option value="2">Elementary</option>
                                <option value="3">Some high school</option>
                                <option value="4">High school graduate</option>
                                <option value="5">Some college or technical school</option>
                                <option value="6">College graduate</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="income">Income Level:</label>
                            <select id="income" name="income">
                                <option value="1">Less than $10,000</option>
                                <option value="2">$10,000 to $14,999</option>
                                <option value="3">$15,000 to $24,999</option>
                                <option value="4">$25,000 to $34,999</option>
                                <option value="5">$35,000 to $49,999</option>
                                <option value="6">$50,000 to $64,999</option>
                                <option value="7">$65,000 to $74,999</option>
                                <option value="8">$75,000 or more</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button type="submit" id="predict-btn">Get Prediction</button>
            </form>
            
            <div class="results" id="results">
                <h2>Your Diabetes Risk Assessment</h2>
                <p id="prediction-result"></p>
                <div class="probability-meter">
                    <div class="probability-fill" id="probability-fill"></div>
                </div>
                <p id="probability-text"></p>
                <p id="disclaimer"><strong>Disclaimer:</strong> This tool provides an estimate based on statistical models and should not replace professional medical advice. Please consult with a healthcare provider for proper diagnosis and treatment.</p>
            </div>
        </div>
        
        <div id="file-upload" class="tab-content">
            <p>Upload a CSV file with health data to get predictions for multiple individuals.</p>
            <p><strong>Required format:</strong> The CSV must include all features used in the model. Please download the template below to ensure correct formatting.</p>
            
            <div class="form-group">
                <a href="#" id="download-template">Download CSV Template</a>
            </div>
            
            <div class="file-upload" id="file-upload-area">
                <p>Drop your CSV file here or click to browse</p>
                <input type="file" id="csv-file" accept=".csv" style="display: none;">
            </div>
            
            <button type="button" id="process-file-btn" disabled>Process File</button>
            
            <div class="results" id="file-results">
                <h2>Batch Processing Results</h2>
                <p id="file-processing-status"></p>
                <div id="file-results-summary"></div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Diabetes Risk Prediction Tool | Based on the Behavioral Risk Factor Surveillance System (BRFSS) data</p>
        <p>Disclaimer: This is an educational tool and should not be used as a substitute for professional medical advice.</p>
    </footer>

    <script>
        // Model coefficients would come from trained model
        // These are placeholder values based on the LDA feature importance shown in your code
        const MODEL = {
            intercept: -2.5,
            coefficients: {
                'HighBP': 0.64,
                'HighChol': 0.52,
                'CholCheck': 0.21,
                'BMI': 0.05,
                'Smoker': 0.14,
                'Stroke': 0.28,
                'HeartDiseaseorAttack': 0.58,
                'PhysActivity': -0.26,
                'Fruits': -0.12,
                'Veggies': -0.08,
                'HvyAlcoholConsump': -0.22,
                'AnyHealthcare': 0.09,
                'NoDocbcCost': 0.19,
                'GenHlth': 0.38,
                'MentHlth': 0.01,
                'PhysHlth': 0.01,
                'DiffWalk': 0.47,
                'Sex': -0.10,
                'Age': 0.18,
                'Education': -0.14,
                'Income': -0.13
            },
            // LDA coefficients for transformed feature
            transformCoefficient: 0.75
        };

        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                // Show corresponding tab content
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        // Prediction form submission
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const data = {};
            
            // Convert form data to object
            for (const [key, value] of formData.entries()) {
                data[key] = parseFloat(value);
            }
            
            // Make prediction
            const prediction = predictDiabetes(data);
            
            // Display results
            displayResults(prediction);
        });

        // Predict diabetes using the model
        function predictDiabetes(data) {
            // Map form field names to model feature names
            const featureMap = {
                'highBP': 'HighBP',
                'highChol': 'HighChol',
                'cholCheck': 'CholCheck',
                'bmi': 'BMI',
                'smoker': 'Smoker',
                'stroke': 'Stroke',
                'heartDisease': 'HeartDiseaseorAttack',
                'physActivity': 'PhysActivity',
                'fruits': 'Fruits',
                'veggies': 'Veggies',
                'hvyAlcoholConsump': 'HvyAlcoholConsump',
                'anyHealthcare': 'AnyHealthcare',
                'noDocbcCost': 'NoDocbcCost',
                'genHlth': 'GenHlth',
                'mentHlth': 'MentHlth',
                'physHlth': 'PhysHlth',
                'diffWalk': 'DiffWalk',
                'sex': 'Sex',
                'age': 'Age',
                'education': 'Education',
                'income': 'Income'
            };
            
            // Calculate LDA transform (weighted sum)
            let ldaValue = 0;
            for (const [formField, modelFeature] of Object.entries(featureMap)) {
                ldaValue += data[formField] * MODEL.coefficients[modelFeature];
            }
            
            // Apply sigmoid function to get probability
            const logit = MODEL.intercept + (ldaValue * MODEL.transformCoefficient);
            const probability = 1 / (1 + Math.exp(-logit));
            
            return {
                probability: probability,
                prediction: probability > 0.5 ? 1 : 0,
                ldaValue: ldaValue
            };
        }

        // Display prediction results
        function displayResults(prediction) {
            const resultsDiv = document.getElementById('results');
            const predictionText = document.getElementById('prediction-result');
            const probabilityFill = document.getElementById('probability-fill');
            const probabilityText = document.getElementById('probability-text');
            
            // Show results div
            resultsDiv.style.display = 'block';
            
            // Set prediction text
            if (prediction.prediction === 1) {
                predictionText.innerHTML = '<strong>Higher Risk:</strong> Based on the provided information, you may have an elevated risk of diabetes or prediabetes.';
                resultsDiv.classList.add('high-risk');
                resultsDiv.classList.remove('low-risk');
            } else {
                predictionText.innerHTML = '<strong>Lower Risk:</strong> Based on the provided information, you appear to have a lower risk of diabetes.';
                resultsDiv.classList.add('low-risk');
                resultsDiv.classList.remove('high-risk');
            }
            
            // Set probability meter
            const probabilityPercentage = Math.round(prediction.probability * 100);
            probabilityFill.style.width = `${probabilityPercentage}%`;
            probabilityText.textContent = `Estimated probability: ${probabilityPercentage}%`;
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // File upload area functionality
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('csv-file');
        const processFileBtn = document.getElementById('process-file-btn');
        
        fileUploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = '#3498db';
            fileUploadArea.style.backgroundColor = '#f1f9ff';
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.style.borderColor = '#ddd';
            fileUploadArea.style.backgroundColor = 'white';
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = '#ddd';
            fileUploadArea.style.backgroundColor = 'white';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelect();
            }
        });
        
        fileInput.addEventListener('change', handleFileSelect);
        
        function handleFileSelect() {
            if (fileInput.files.length) {
                const file = fileInput.files[0];
                if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                    fileUploadArea.innerHTML = `<p>Selected: ${file.name}</p>`;
                    processFileBtn.disabled = false;
                } else {
                    alert('Please select a CSV file.');
                    fileInput.value = '';
                    fileUploadArea.innerHTML = '<p>Drop your CSV file here or click to browse</p>';
                    processFileBtn.disabled = true;
                }
            }
        }
        
        // CSV template download
        document.getElementById('download-template').addEventListener('click', function(e) {
            e.preventDefault();
            
            // CSV header
            const headers = [
                'HighBP', 'HighChol', 'CholCheck', 'BMI', 'Smoker', 'Stroke', 
                'HeartDiseaseorAttack', 'PhysActivity', 'Fruits', 'Veggies', 
                'HvyAlcoholConsump', 'AnyHealthcare', 'NoDocbcCost', 'GenHlth', 
                'MentHlth', 'PhysHlth', 'DiffWalk', 'Sex', 'Age', 'Education', 'Income'
            ];
            
            // Example row
            const exampleRow = [
                '1', '0', '1', '27.8', '0', '0', '0', '1', '1', '1', 
                '0', '1', '0', '2', '0', '0', '0', '0', '5', '5', '6'
            ];
            
            // Create CSV content
            let csvContent = headers.join(',') + '\n' + exampleRow.join(',');
            
            // Create a blob and download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'diabetes_prediction_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // Process file button
        processFileBtn.addEventListener('click', function() {
            const file = fileInput.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                processCSV(content);
            };
            reader.readAsText(file);
        });
        
        function processCSV(csvContent) {
            // Simple CSV parsing (for a production app, use a proper CSV library)
            const lines = csvContent.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Check if required columns exist (simplified check)
            const requiredColumns = Object.values(MODEL.coefficients);
            let allColumnsPresent = true;
            
            // Status update
            const fileResults = document.getElementById('file-results');
            const fileProcessingStatus = document.getElementById('file-processing-status');
            const fileResultsSummary = document.getElementById('file-results-summary');
            
            fileResults.style.display = 'block';
            fileProcessingStatus.textContent = 'Processing file...';
            
            // Simulating processing delay
            setTimeout(() => {
                // In a real application, you would process each row here
                const totalRows = lines.length - 1; // Excluding header
                const processedRows = Math.max(0, totalRows);
                const predictedDiabetic = Math.floor(Math.random() * processedRows * 0.3); // Just for demo
                
                fileProcessingStatus.textContent = 'File processed successfully!';
                
                if (allColumnsPresent) {
                    // Process data rows
                    const results = {
                        total: processedRows,
                        diabetic: predictedDiabetic,
                        nonDiabetic: processedRows - predictedDiabetic
                    };
                    
                    // Display results
                    fileResultsSummary.innerHTML = `
                        <h3>Summary Results</h3>
                        <p>Total records processed: ${results.total}</p>
                        <p>Predicted diabetic: ${results.diabetic} (${Math.round(results.diabetic / results.total * 100)}%)</p>
                        <p>Predicted non-diabetic: ${results.nonDiabetic} (${Math.round(results.nonDiabetic / results.total * 100)}%)</p>
                    `;
                } else {
                    fileProcessingStatus.textContent = 'Error: CSV file is missing required columns.';
                    fileResultsSummary.innerHTML = '';
                }
            }, 1500);
        }
        
        // Initialize form with some default values
        document.getElementById('bmi').value = '25.0';
        document.getElementById('age').value = '5'; // 40-44 age group
        document.getElementById('genHlth').value = '3'; // Good health
    </script>
</body>
</html>
